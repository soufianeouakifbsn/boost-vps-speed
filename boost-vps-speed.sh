#!/bin/bash
# Ø³ÙƒØ±Ø¨Øª Ù…ÙØ¹Ø¯Ù‘ÙŽÙ„ Ø¥Ø¶Ø§ÙÙŠÙ‹Ø§ Ù„Ø¶Ø¨Ø· Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª sysctl ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ (Ù…Ø­Ø§ÙˆÙ„Ø© Ø£ÙƒØ«Ø± Ø¬Ø°Ø±ÙŠØ©) ðŸš€

echo "ðŸ”§ ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„Ø´Ø¨ÙƒØ© (Ù…Ø­Ø§ÙˆÙ„Ø© Ø£ÙƒØ«Ø± Ø¬Ø°Ø±ÙŠØ©)..."

# ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ù„Ù‰ sysctl.conf
cat > /etc/sysctl.conf <<EOF
# ==== ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø´Ø¨ÙƒØ© (ØªØ±ÙƒÙŠØ² Ù‚ÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©) ====

# ØªØ®ØµÙŠØµ Ø°Ø§ÙƒØ±Ø© TCP (Ù‚ÙŠÙ… Ø£Ø¹Ù„Ù‰ Ù„Ø²ÙŠØ§Ø¯Ø© Ù‚Ø¯Ø±Ø© Ø§Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨)
net.core.rmem_default = 33554432
net.core.rmem_max = 268435456
net.core.wmem_default = 33554432
net.core.wmem_max = 268435456

# ØªØ®ØµÙŠØµ Ø°Ø§ÙƒØ±Ø© TCP Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ù‚Ù„ (Ù‚ÙŠÙ… Ø£Ø¹Ù„Ù‰ Ù„ØªØ¯ÙÙ‚ Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙØ¶Ù„)
net.ipv4.tcp_rmem = 4096 174760 268435456
net.ipv4.tcp_wmem = 4096 219000 268435456

# ØªØ®ØµÙŠØµ Ø­Ø¬Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ù€ TCP (Ù‚ÙŠÙ…Ø© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ù‹Ø§ Ù„ØªØ­Ù…Ù„ Ø§Ù„Ø§Ø²Ø¯Ø­Ø§Ù… Ø§Ù„Ø´Ø¯ÙŠØ¯)
net.core.netdev_max_backlog = 2000000
net.core.somaxconn = 65536

# Ø§Ø³ØªØ®Ø¯Ø§Ù… TCP BBRv2 (Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø£Ø­Ø¯Ø« ÙˆØ£ÙƒØ«Ø± Ø¹Ø¯ÙˆØ§Ù†ÙŠØ© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ© ÙˆØªÙ‚Ù„ÙŠÙ„ Ø²Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„)
# ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù†ÙˆØ§Ø© Ù†Ø¸Ø§Ù…Ùƒ ØªØ¯Ø¹Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ©.
net.core.default_qdisc=fq_codel
net.ipv4.tcp_congestion_control = bbr2
net.netfilter.nf_conntrack_max = 1048576
net.netfilter.nf_conntrack_tcp_timeout_established = 7440

net.ipv4.tcp_mtu_probing = 1
net.ipv4.tcp_no_metrics_save = 1
net.ipv4.tcp_window_scaling = 1

# ØªÙØ¹ÙŠÙ„ TCP Fast Open Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø§ØªØµØ§Ù„
net.ipv4.tcp_fastopen = 3

# ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„Ù„Ù…Ù†Ø§ÙØ° (Ù†Ø·Ø§Ù‚ ÙˆØ§Ø³Ø¹)
net.ipv4.ip_local_port_range = 1024 65535

# ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙÙŠ TCP (Ù‚ÙŠÙ… Ø£ÙƒØ«Ø± Ø¹Ø¯ÙˆØ§Ù†ÙŠØ© Ù„ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø³Ø±Ø¹Ø©)
net.ipv4.tcp_fin_timeout = 5
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 1

# ØªØ¹Ø·ÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªØ³Ø¨Ø¨ Ø­Ù…Ù„Ù‹Ø§ Ø¥Ø¶Ø§ÙÙŠÙ‹Ø§
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv6.conf.all.disable_ipv6 = 1 # ØªØ¹Ø·ÙŠÙ„ IPv6 Ø¥Ø°Ø§ ÙƒÙ†Øª Ù„Ø§ ØªØ³ØªØ®Ø¯Ù…Ù‡

# ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙÙŠ TCP
net.ipv4.tcp_moderate_rcvbuf = 1
net.ipv4.tcp_timestamps = 0
net.ipv4.tcp_sack = 1 # ØªÙØ¹ÙŠÙ„ Selective Acknowledgements

# Ù‚ÙŠÙ… Ø¥Ø¶Ø§ÙÙŠØ© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
net.core.optmem_max = 2048000
net.ipv4.tcp_slow_start_after_idle = 0
EOF

# ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
sudo sysctl -p

echo "âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª sysctl Ø¨Ù†Ø¬Ø§Ø­ (Ù…Ø­Ø§ÙˆÙ„Ø© Ø£ÙƒØ«Ø± Ø¬Ø°Ø±ÙŠØ©)!"

# Ø¶Ø¨Ø· Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© (ulimit)
echo "ðŸ”§ Ø±ÙØ¹ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©..."

sudo ulimit -n 2097152

# Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¯Ø§Ø¦Ù…Ø©
sudo cat >> /etc/security/limits.conf <<EOF

# ==== Ø±ÙØ¹ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© ====
* soft nofile 2097152
* hard nofile 2097152
EOF

echo "âœ… ØªÙ… Ø¶Ø¨Ø· limits.conf Ø¨Ù†Ø¬Ø§Ø­!"

echo ""
echo "âš ï¸ **ØªØ­Ø°ÙŠØ± Ù‡Ø§Ù…:** Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙƒØ«Ø± Ø¹Ø¯ÙˆØ§Ù†ÙŠØ© ÙˆÙ‚Ø¯ Ù„Ø§ ØªÙƒÙˆÙ† Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø£Ùˆ Ø§Ù„Ø´Ø¨ÙƒØ§Øª."
echo "   Ø±Ø§Ù‚Ø¨ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø´Ø¨ÙƒØ© Ø¨Ø¹Ù†Ø§ÙŠØ© Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„."
echo ""

# Ø£Ø¯ÙˆØ§Øª ØªØ´Ø®ÙŠØµÙŠØ© Ù…Ù‚ØªØ±Ø­Ø©:
echo "ðŸ› ï¸ **Ø£Ø¯ÙˆØ§Øª ØªØ´Ø®ÙŠØµÙŠØ© Ù‚Ø¯ ØªØ³Ø§Ø¹Ø¯Ùƒ:**"
echo "1. **ping:** Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø²Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø©:"
echo "   \`ping -c 10 google.com\` Ø£Ùˆ \`ping -c 10 your_isp_router_ip\`"
echo "2. **traceroute (Ø£Ùˆ tracert Ø¹Ù„Ù‰ ÙˆÙŠÙ†Ø¯ÙˆØ²):** Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø°ÙŠ ØªØ³Ù„ÙƒÙ‡ Ø§Ù„Ø­Ø²Ù… Ø¥Ù„Ù‰ ÙˆØ¬Ù‡Ø© Ù…Ø¹ÙŠÙ†Ø©:"
echo "   \`traceroute google.com\`"
echo "3. **speedtest-cli:** Ø£Ø¯Ø§Ø© Ø³Ø·Ø± Ø£ÙˆØ§Ù…Ø± Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±Ø¹Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ (Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ«Ø¨ÙŠØªÙ‡Ø§):"
echo "   \`sudo apt update && sudo apt install speedtest-cli\` Ø«Ù… \`speedtest-cli\`"
echo "4. **iftop:** Ù„Ø¹Ø±Ø¶ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ±Ø¯Ø¯ÙŠ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ Ù„ÙƒÙ„ Ø§ØªØµØ§Ù„ (Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ«Ø¨ÙŠØªÙ‡Ø§):"
echo "   \`sudo apt update && sudo apt install iftop\` Ø«Ù… \`sudo iftop\`"
echo "5. **sar (System Activity Reporter):** Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ø±Ø¯:"
echo "   \`sar -n DEV 1 5\` (Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©)"

echo ""
echo "ðŸ’¡ **Ù†ØµØ§Ø¦Ø­ Ø¥Ø¶Ø§ÙÙŠØ©:**"
echo "- ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ´ØºÙŠÙ„ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ø¯ÙŠÙƒ Ù‡Ùˆ Ø§Ù„Ø£Ø­Ø¯Ø«."
echo "- ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ù‡Ø§Ø² Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ (Ø§Ù„Ø±Ø§ÙˆØªØ±) Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ÙˆØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙˆÙ„ÙŠØ³ Ù‡Ù†Ø§Ùƒ Ø£ÙŠ Ù‚ÙŠÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ±Ø¯Ø¯ÙŠ."
echo "- Ù‚Ø¯ ØªÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø¹ÙˆØ§Ù…Ù„ Ø£Ø®Ø±Ù‰ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø³Ø±Ø¹Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù„Ø¯ÙŠÙƒ Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ø¸Ø§Ù…Ùƒ (Ù…Ø«Ù„ Ø§Ø²Ø¯Ø­Ø§Ù… Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ø¯Ù‰ Ù…Ø²ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø©)."

echo ""
echo "ðŸš€ ÙƒÙ„ Ø´ÙŠØ¡ Ø¬Ø§Ù‡Ø²! Ù…Ù† Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¢Ù† Ù„ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ù‡ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª."
echo "Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¢Ù† Ø§ÙƒØªØ¨: sudo reboot"
