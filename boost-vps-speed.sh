#!/bin/bash
# Ø³ÙƒØ±Ø¨Øª Ø¶Ø¨Ø· Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª sysctl Ù„ØªØ­Ø³ÙŠÙ† Ø³Ø±Ø¹Ø© Ø§Ù„Ø£Ø¨Ù„ÙˆØ¯ ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù… ðŸš€ (Ù…ÙØ¹Ø¯Ù‘ÙŽÙ„)

echo "ðŸ”§ ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„Ø´Ø¨ÙƒØ© (Ù…ÙØ¹Ø¯Ù‘ÙŽÙ„Ø© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¨Ù„ÙˆØ¯)..."

# ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ù„Ù‰ sysctl.conf
cat > /etc/sysctl.conf <<EOF
# ==== ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø´Ø¨ÙƒØ© (ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¨Ù„ÙˆØ¯ ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…) ====

# ØªØ®ØµÙŠØµ Ø°Ø§ÙƒØ±Ø© TCP (Ù‚ÙŠÙ… Ø£Ø¹Ù„Ù‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¯ÙÙ‚)
net.core.rmem_default = 2097152
net.core.rmem_max = 67108864
net.core.wmem_default = 2097152
net.core.wmem_max = 67108864

# ØªØ®ØµÙŠØµ Ø°Ø§ÙƒØ±Ø© TCP Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ù‚Ù„ (Ù‚ÙŠÙ… Ø£Ø¹Ù„Ù‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¯ÙÙ‚)
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864

# ØªØ®ØµÙŠØµ Ø­Ø¬Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ù€ TCP (Ù‚ÙŠÙ…Ø© Ø¹Ø§Ù„ÙŠØ© Ù„ØªØ­Ù…Ù„ Ø§Ù„Ø§Ø²Ø¯Ø­Ø§Ù… Ø§Ù„Ù…Ø¤Ù‚Øª)
net.core.netdev_max_backlog = 1000000
net.core.somaxconn = 65536

# Ø§Ø³ØªØ®Ø¯Ø§Ù… TCP Cubic Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ (Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø­Ø¯ÙŠØ«Ø© ÙˆÙØ¹Ø§Ù„Ø©)
net.ipv4.tcp_congestion_control = cubic
net.ipv4.tcp_mtu_probing = 1
net.ipv4.tcp_no_metrics_save = 1
net.ipv4.tcp_window_scaling = 1

# ØªÙØ¹ÙŠÙ„ TCP Fast Open Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø§ØªØµØ§Ù„ (Ù…ÙÙŠØ¯ Ù„Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©)
net.ipv4.tcp_fastopen = 3

# ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„Ù„Ù…Ù†Ø§ÙØ° (Ù†Ø·Ø§Ù‚ ÙˆØ§Ø³Ø¹ Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ø³ØªÙ†ÙØ§Ø¯ Ø§Ù„Ù…Ù†Ø§ÙØ°)
net.ipv4.ip_local_port_range = 1024 65535

# ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙÙŠ TCP (Ù‚ÙŠÙ… Ù…ØªØ­ÙØ¸Ø© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¯ÙˆÙ† Ù…Ø®Ø§Ø·Ø±)
net.ipv4.tcp_fin_timeout = 15
net.ipv4.tcp_tw_reuse = 1

# ØªØ¹Ø·ÙŠÙ„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© (Ø¥Ø¬Ø±Ø§Ø¡ Ø£Ù…Ù†ÙŠ Ù‚ÙŠØ§Ø³ÙŠ)
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.all.send_redirects = 0

# ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙÙŠ TCP (ØªÙØ¹ÙŠÙ„ Ù„ØªÙƒÙŠÙŠÙ Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©)
net.ipv4.tcp_moderate_rcvbuf = 1
net.ipv4.tcp_timestamps = 0

# Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø­Ø²Ù… (ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ… Ù„ØªÙƒÙˆÙ† Ø£ÙƒØ«Ø± ØªÙˆØ§Ø²Ù†Ø§Ù‹)
# Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… ØªÙ… ØªØ¶Ù…ÙŠÙ†Ù‡Ø§ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰
# net.ipv4.tcp_rmem = 4096 87380 134217728
# net.ipv4.tcp_wmem = 4096 65536 134217728

# ØªØ­Ø³ÙŠÙ† Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ (ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠÙ‚ÙˆÙ… Ø¨Ø¯ÙˆØ± Ø§Ù„Ù…ÙˆØ¬Ù‡)
# Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ù…Ø¬Ø±Ø¯ Ø¬Ù‡Ø§Ø² Ø¹Ø§Ø¯ÙŠØŒ ÙÙ‚Ø¯ Ù„Ø§ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù‡Ø°Ø§.
# net.ipv4.ip_forward = 0

# ==== ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… ====

# Ø²ÙŠØ§Ø¯Ø© Ø­Ø¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© (Ù‚ÙŠÙ…Ø© Ø¹Ø§Ù„ÙŠØ© Ù„Ø¯Ø¹Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„ØªÙŠ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¹Ø¯Ø¯ ÙƒØ¨ÙŠØ± Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª)
fs.file-max = 2097152

# ØªØ®ØµÙŠØµ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Ù‚ÙŠÙ…Ø© Ø¹Ø§Ù„ÙŠØ© Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¹Ø¯Ø¯ ÙƒØ¨ÙŠØ± Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª)
fs.inotify.max_user_watches = 524288

# ØªØ®ØµÙŠØµ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ù‚ÙŠÙ…Ø© Ø£Ù‚Ù„ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ØŒ Ø®Ø§ØµØ© Ù„Ù„Ø£Ø¨Ù„ÙˆØ¯)
vm.swappiness = 5
EOF

# ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
sysctl -p

echo "âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª sysctl Ø¨Ù†Ø¬Ø§Ø­ (Ù…ÙØ¹Ø¯Ù‘ÙŽÙ„Ø©)!"

# Ø¶Ø¨Ø· Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© (ulimit)
echo "ðŸ”§ Ø±ÙØ¹ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©..."

ulimit -n 1048576

# Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¯Ø§Ø¦Ù…Ø©
cat >> /etc/security/limits.conf <<EOF

# ==== Ø±ÙØ¹ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© ====
* soft nofile 1048576
* hard nofile 1048576
EOF

echo "âœ… ØªÙ… Ø¶Ø¨Ø· limits.conf Ø¨Ù†Ø¬Ø§Ø­!"

# Ù†ØµÙŠØ­Ø©
echo ""
echo "ðŸš€ ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø¹Ø¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¹Ù„Ù‰ Ø³Ø±Ø¹Ø© Ø§Ù„Ø£Ø¨Ù„ÙˆØ¯ ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…Ø©."
echo "ðŸ’¡ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ­Ø³Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨ÙƒÙØ§Ø¡Ø©."
echo "Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¢Ù† Ø§ÙƒØªØ¨: sudo reboot"
